FROM python:3.7

RUN pip install --extra-index-url https://hosted.chia.net/simple/ chia-blockchain==1.1.4 miniupnpc==2.1
RUN pip install --force-reinstall git+https://github.com/ericaltendorf/plotman@main
    
COPY keyfile init.sh init-plotman.sh /root/
COPY plotman.yaml /root/.config/plotman/

RUN chia init
RUN chia keys add -f /root/keyfile && \
    rm /root/keyfile && \
    chia plots add -d /plots

CMD bash /root/init-plotman.sh
